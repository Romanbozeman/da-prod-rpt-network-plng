WITH
  WC_TICKET AS (
  SELECT
    WC_TICKET.*
  FROM
    da-prod-dwh-dw01.DP_BASE_IQGEO_V.MYWCM_WIRE_CENTER_PROJECT_V WC_TICKET
  LEFT JOIN
    `da-prod-dwh-dw01.DP_BASE_IQGEO_V.MYWWFM_TICKET_V` TICKET
  ON
    WC_TICKET.PROPERTIES_MYWWFM_TICKET_ID = TICKET.PROPERTIES_ID
    AND PROPERTIES_MYWWFM_TYPE = 'Wire Center Project'
    AND PROPERTIES_MYWWFM_STATUS != 'Cancelled'),
  TICKET AS (
  SELECT
    *,
    SPLIT(PROPERTIES_MYWWFM_PROJECT_NAME, '-')[
  OFFSET
    (0)] AS TICKET_NAME,
  FROM
    `da-prod-dwh-dw01.DP_BASE_IQGEO_V.MYWWFM_TICKET_V`
  WHERE
    PROPERTIES_MYWWFM_TYPE <> 'Wire Center Project'),
  SURVEY AS (
  SELECT
    SURVEY.*,
    WC_TICKET.PROPERTIES_CLLI AS SURVEY_CLLI
  FROM
    da-prod-dwh-dw01.DP_BASE_IQGEO_V.MYWCM_SURVEY_TICKET_V SURVEY
  LEFT JOIN
    WC_TICKET
  ON
    SURVEY.PROPERTIES_PARENT = WC_TICKET.PROPERTIES_MYWWFM_TICKET_ID ),
  DTAP AS (
  SELECT
    DTAP.*,
    WC_TICKET.PROPERTIES_CLLI AS DTAP_CLLI
  FROM
    da-prod-dwh-dw01.DP_BASE_IQGEO_V.MYWCM_DTAP_TICKET_V DTAP
  LEFT JOIN
    WC_TICKET
  ON
    DTAP.PROPERTIES_PARENT = WC_TICKET.PROPERTIES_MYWWFM_TICKET_ID ),
  FEEDER AS (
  SELECT
    FEEDER.*,
    WC_TICKET.PROPERTIES_CLLI AS FEEDER_CLLI
  FROM
    da-prod-dwh-dw01.DP_BASE_IQGEO_V.MYWCM_FEEDER_TICKET_V FEEDER
  LEFT JOIN
    WC_TICKET
  ON
    FEEDER.PROPERTIES_PARENT = WC_TICKET.PROPERTIES_MYWWFM_TICKET_ID),
  PERMIT AS (
  SELECT
    *
  FROM
    da-prod-dwh-dw01.DP_BASE_IQGEO_V.PERMIT_TICKET_V)
  -- FPS_SCENARIO AS (
  -- SELECT
  --   *
  -- FROM
  --   da-prod-dwh-dw01.DP_BASE_IQGEO_V.FPS_SCENARIO_V)
SELECT
  TICKET.PROPERTIES_ID AS TICKET_PROPERTIES_ID,
  TICKET.PROPERTIES_MYWWFM_CREATOR_USERNAME AS TICKET_CREATOR_USERNAME,
  TICKET.PROPERTIES_MYWWFM_ASSIGNED_USERNAME AS TICKET_ASSIGNED_USERNAME,
  TICKET.PROPERTIES_MYWWFM_STATUS AS TICKET_STATUS,
  TICKET.PROPERTIES_MYWWFM_TYPE AS TICKET_TYPE,
  TICKET.PROPERTIES_MYWWFM_TYPE_CATEGORY AS TICKET_TYPE_CATEGORY,
  TICKET.PROPERTIES_MYWWFM_CANCELLED_DATETIME AS TICKET_CANCELLED_DATETIME,
  TICKET.PROPERTIES_MYWWFM_CREATED_DATETIME AS TICKET_CREATED_DATETIME,
  TICKET.PROPERTIES_MYWWFM_ASSIGNED_DATETIME AS TICKET_ASSIGNED_DATETIME,
  TICKET.PROPERTIES_MYWWFM_LAST_MODIFIED_DATETIME AS TICKET_LAST_MODIFIED_DATETIME,
  TICKET.PROPERTIES_MYWWFM_TICKET_GROUP AS TICKET_GROUP,
  TICKET.PROPERTIES_MYWWFM_REGION AS TICKET_REGION,
  TICKET.PROPERTIES_MYWWFM_UPDATE_DATETIME AS TICKET_UPDATE_DATETIME,
  TICKET.PROPERTIES_MYWWFM_START_DATETIME AS TICKET_START_DATETIME,
  TICKET.PROPERTIES_MYWWFM_DUE_DATETIME AS TICKET_DUE_DATETIME,
  TICKET.PROPERTIES_MYWWFM_TICKET_DETAILS AS TICKET_TICKET_DETAILS,
  TICKET.PROPERTIES_MYWWFM_ONSITE_DATETIME AS TICKET_ONSITE_DATETIME,
  TICKET.PROPERTIES_MYWWFM_PROJECT AS TICKET_PROJECT,
  TICKET.PROPERTIES_MYWWFM_PROJECT_NAME AS PARENT_TICKET_PROJECT_NAME,
  CASE --
    WHEN (TICKET_NAME <> SURVEY.SURVEY_CLLI AND SURVEY.SURVEY_CLLI IS NOT NULL) THEN SURVEY.SURVEY_CLLI
    WHEN (TICKET_NAME <> DTAP.DTAP_CLLI
    AND DTAP.DTAP_CLLI IS NOT NULL) THEN DTAP.DTAP_CLLI
    WHEN (TICKET_NAME <> FEEDER.FEEDER_CLLI AND FEEDER.FEEDER_CLLI IS NOT NULL) THEN FEEDER.FEEDER_CLLI
  ELSE
  TICKET_NAME
END
  AS PARSED_CLLI,
  WC_TICKET.PROPERTIES_CLLI AS WC_TICKET_CLLI,
  WC_TICKET.PROPERTIES_MYWWFM_TICKET_ID AS WC_TICKET_ID,
  WC_TICKET.PROPERTIES_MYWWFM_TICKET_GROUP AS WC_PROPERTIES_TICKET_GROUP,
  WC_TICKET.PROPERTIES_PROFILE AS WC_PROFILE,
  WC_TICKET.PROPERTIES_COMPANY_CODE AS WC_COMPANY_CODE,
  WC_TICKET.PROPERTIES_INVESTMENT_PROGRAM AS WC_INVESTMENT_YEAR,
  WC_TICKET.PROPERTIES_APPROVAL_YEAR AS WC_APPROVAL_YEAR,
  WC_TICKET.PROPERTIES_SAP_PROJECT_NUMBER AS WC_SAP_PROJECT_NUMBER,
  WC_TICKET.PROPERTIES_SAP_WBS_EXPENSE AS WC_SAP_WBS_EXPENSE,
  WC_TICKET.PROPERTIES_SAP_WBS_CAPITAL AS WC_SAP_WBS_CAPITAL,
  WC_TICKET.PROPERTIES_SAP_STATUS AS WC_SAP_STATUS,
  WC_TICKET.PROPERTIES_SAP_LOG AS WC_SAP_LOG,
  WC_TICKET.PROPERTIES_REQUESTOR_COST_CENTER AS WC_REQUESTOR_COST_CENTER,
  WC_TICKET.PROPERTIES_RESPONDER_COST_CENTER AS WC_RESPONDER_COST_CENTER,
  WC_TICKET.PROPERTIES_START_DATE_PLANNING AS WC_START_DATE_PLANNING,
  WC_TICKET.PROPERTIES_END_DATE_PLANNING AS WC_END_DATE_PLANNING,
  WC_TICKET.PROPERTIES_START_DATE_SURVEY AS WC_START_DATE_SURVEY,
  WC_TICKET.PROPERTIES_END_DATE_SURVEY AS WC_END_DATE_SURVEY,
  WC_TICKET.PROPERTIES_START_DATE_PERMIT AS WC_START_DATE_PERMIT,
  WC_TICKET.PROPERTIES_END_DATE_PERMIT AS WC_END_DATE_PERMIT,
  WC_TICKET.PROPERTIES_START_DATE_CONSTRUCTION AS WC_START_DATE_CONSTRUCTION,
  WC_TICKET.PROPERTIES_END_DATE_CONSTRUCTION AS WC_END_DATE_CONSTRUCTION,
  WC_TICKET.PROPERTIES_CONTRACTOR AS WC_CONTRACTOR,
  WC_TICKET.PROPERTIES_CITY AS WC_CITY,
  WC_TICKET.PROPERTIES_STATE AS WC_STATE,
  WC_TICKET.PROPERTIES_ZIP AS WC_ZIP,
  WC_TICKET.PROPERTIES_STREET AS WC_STREET,
  WC_TICKET.PROPERTIES_LOCATION AS WC_LOCATION,
  WC_TICKET.PROPERTIES_ROUTE_OH AS WC_ROUTE_OH,
  WC_TICKET.PROPERTIES_ROUTE_UG AS WC_ROUTE_UG,
  WC_TICKET.PROPERTIES_DTAPS_UG AS WC_DTAPS_UG,
  WC_TICKET.PROPERTIES_DTAPS_OH AS WC_DTAPS_OH,
  COALESCE(WC_TICKET.PROPERTIES_MYWWFM_TICKET_ID,SURVEY.PROPERTIES_PARENT,DTAP.PROPERTIES_PARENT,FEEDER.PROPERTIES_PARENT,PERMIT.PROPERTIES_PARENT) AS
    PROPERTIES_PARENT_ID,
  SURVEY.PROPERTIES_ID AS SURVEY_PROPERTIES_ID,
  SURVEY.PROPERTIES_START_DATE AS SURVEY_ACTUAL_START_DATE,
  SURVEY.PROPERTIES_END_DATE AS SURVEY_ACTUAL_END_DATE,
  DTAP.PROPERTIES_ID AS DTAP_PROPERTIES_ID,
  DTAP.PROPERTIES_MYWWFM_TICKET_ID AS DTAP_TICKET_ID,
  DTAP.PROPERTIES_CONTRACTOR AS DTAP_CONTRACTOR,
  DTAP.PROPERTIES_START_DATE AS DTAP_ACTUAL_START_DATE,
  DTAP.PROPERTIES_END_DATE AS DTAP_ACTUAL_END_DATE,
  DTAP.PROPERTIES_PLACEMENT AS DTAP_PLACEMENT,
  DTAP.PROPERTIES_DTAP_NAME DTAP_NAME,
  DTAP.PROPERTIES_REFERENCE AS DTAP_REFERENCE,
  DTAP.PROPERTIES_DTAP_PASS_FAIL_1 AS DTAP_PASS_FAIL_1,
  DTAP.PROPERTIES_DTAP_READING_1 AS DTAP_READING_1,
  DTAP.PROPERTIES_DTAP_PASS_FAIL_2 AS DTAP_PASS_FAIL_2,
  DTAP.PROPERTIES_DTAP_READING_2 AS DTAP_READING_2,
  DTAP.PROPERTIES_DTAP_PASS_FAIL_3 AS DTAP_PASS_FAIL_3,
  DTAP.PROPERTIES_DTAP_READING_3 AS DTAP_READING_3,
  DTAP.PROPERTIES_DTAP_PASS_FAIL_4 AS DTAP_PASS_FAIL_4,
  DTAP.PROPERTIES_DTAP_READING_4 AS DTAP_READING_4,
  DTAP.PROPERTIES_DTAP_PASS_FAIL_5 AS DTAP_PASS_FAIL_5,
  DTAP.PROPERTIES_DTAP_READING_5 AS DTAP_READING_5,
  DTAP.PROPERTIES_DTAP_PASS_FAIL_6 AS DTAP_PASS_FAIL_6,
  DTAP.PROPERTIES_DTAP_READING_6 AS DTAP_READING_6,
  DTAP.PROPERTIES_RUN_PASS_FAIL_1 AS DTAP_RUN_PASS_FAIL_1,
  DTAP.PROPERTIES_RUN_READING_1 AS DTAP_RUN_READING_1,
  DTAP.PROPERTIES_RUN_PASS_FAIL_2 AS DTAP_RUN_PASS_FAIL_2,
  DTAP.PROPERTIES_RUN_READING_2 AS DTAP_RUN_READING_2,
  DTAP.PROPERTIES_RUN_PASS_FAIL_3 AS DTAP_RUN_PASS_FAIL_3,
  DTAP.PROPERTIES_RUN_READING_3 AS DTAP_RUN_READING_3,
  DTAP.PROPERTIES_RUN_PASS_FAIL_4 AS DTAP_RUN_PASS_FAIL_4,
  DTAP.PROPERTIES_RUN_READING_4 AS DTAP_RUN_READING_4,
  DTAP.PROPERTIES_RUN_PASS_FAIL_5 AS DTAP_RUN_PASS_FAIL_5,
  DTAP.PROPERTIES_RUN_READING_5 AS DTAP_RUN_READING_5,
  DTAP.PROPERTIES_RUN_PASS_FAIL_6 AS DTAP_RUN_PASS_FAIL_6,
  DTAP.PROPERTIES_RUN_READING_6 AS DTAP_RUN_READING_6,
  DTAP.PROPERTIES_PATH_UNDERGROUND_FOOTAGE AS DTAP_UNDERGROUND_FOOTAGE,
  DTAP.PROPERTIES_PATH_UNDERGROUND_WIDTH AS DTAP_UNDERGROUND_WIDTH,
  DTAP.PROPERTIES_PATH_UNDERGROUND_DEPTH AS DTAP_UNDERGROUND_DEPTH,
  DTAP.PROPERTIES_PATH_BURIED_FOOTAGE AS DTAP_BURIED_FOOTAGE,
  DTAP.PROPERTIES_PATH_BURIED_WIDTH AS DTAP_BURIED_WIDTH,
  DTAP.PROPERTIES_PATH_BURIED_DEPTH AS DTAP_BURIED_DEPTH,
  DTAP.PROPERTIES_PATH_AERIAL_FOOTAGE AS DTAP_AERIAL_FOOTAGE,
  DTAP.PROPERTIES_AERIAL_COMPLETE AS DTAP_AERIAL_COMPLETE,
  DTAP.PROPERTIES_BURRIED_COMPLETE AS DTAP_BURRIED_COMPLETE,
  FEEDER.PROPERTIES_ID AS FEEDER_PROPERTIES_ID,
  FEEDER.PROPERTIES_MYWWFM_TICKET_ID AS FEEDER_TICKET_ID,
  FEEDER.PROPERTIES_AERIAL_FOOTAGE AS FEEDER_AERIAL_FOOTAGE,
  FEEDER.PROPERTIES_PATH_UNDERGROUND_DEPTH AS FEEDER_PATH_UNDERGROUND_DEPTH,
  FEEDER.PROPERTIES_CABLE_LENGTH AS FEEDER_CABLE_LENGTH,
  FEEDER.PROPERTIES_MYWWFM_TICKET_GROUP AS FEEDER_TICKET_GROUP,
  FEEDER.PROPERTIES_MYWWFM_COMMENTS AS FEEDER_COMMENTS,
  FEEDER.PROPERTIES_START_DATE AS FEEDER_START_DATE,
  FEEDER.PROPERTIES_END_DATE AS FEEDER_END_DATE,
  FEEDER.PROPERTIES_BURRIED_COMPLETE AS FEEDER_BURRIED_COMPLETE,
  FEEDER.PROPERTIES_AERIAL_COMPLETE AS FEEDER_AERIAL_COMPLETE,
  FEEDER.PROPERTIES_PLACEMENT AS FEEDER_PLACEMENT,
  FEEDER.PROPERTIES_PATH_UNDERGROUND_WIDTH AS FEEDER_PATH_UG_WIDTH,
  FEEDER.PROPERTIES_PARENT AS FEEDER_PROPERTIES_PARENT,
  FEEDER.PROPERTIES_UNDERGROUND_FOOTAGE AS FEEDER_UG_FOOTAGE,
  FEEDER.PROPERTIES_BURIED_FOOTAGE AS FEEDER_BURIED_FOOTAGE,
  FEEDER.PROPERTIES_NOOF_CABLES AS FEEDER_NOOF_CABLES,
  FEEDER.PROPERTIES_MYWWFM_LAST_MODIFIED_DATETIME AS FEEDER_LAST_MODIFIED_DATETIME,
  FEEDER.PROPERTIES_PATH_BURIED_FOOTAGE AS FEEDER_PATH_BURIED_FOOTAGE,
  FEEDER.PROPERTIES_TOTAL_FOOTAGE AS FEEDER_TOTAL_FOOTAGE,
  FEEDER.PROPERTIES_PATH_AERIAL_FOOTAGE AS FEEDER_PATH_AERIAL_FOOTAGE,
  FEEDER.PROPERTIES_TYPE AS FEEDER_PROPERTIES_TYPE,
  FEEDER.PROPERTIES_PATH_UNDERGROUND_FOOTAGE AS FEEDER_PATH_UNDERGROUND_FOOTAGE,
  FEEDER.PROPERTIES_CONTRACTOR AS FEEDER_CONTRACTOR,
  FEEDER.PROPERTIES_PATH_TRENCH_MATERIAL AS FEEDER_PATH_TRENCH_MATERIAL,
  FEEDER.PROPERTIES_PATH_BURIED_DEPTH AS FEEDER_PATH_BURIED_DEPTH,
  FEEDER.PROPERTIES_MYWWFM_ADDRESS AS FEEDER_ADDRESS,
  FEEDER.PROPERTIES_REFERENCE AS FEEDER_PROPERTIES_REFERENCE,
  FEEDER.PROPERTIES_PATH_BURIED_WIDTH AS FEEDER_PATH_BURIED_WIDTH,
  PERMIT.PROPERTIES_ID AS PERMIT_PROPERTIES_ID,
  PERMIT.PROPERTIES_MYWWFM_TICKET_ID AS PERMIT_TICKET_ID,
  PERMIT.PROPERTIES_PARENT AS PERMIT_PROPERTIES_PARENT,
  PERMIT.PROPERTIES_CONTRACTOR AS PERMIT_CONTRACTOR,
  PERMIT.PROPERTIES_MYWWFM_TICKET_GROUP AS PERMIT_TICKET_GROUP,
  PERMIT.PROPERTIES_MYWWFM_ADDRESS AS PERMIT_ADDRESS,
  PERMIT.PROPERTIES_START_DATE AS PERMIT_START_DATE,
  PERMIT.PROPERTIES_END_DATE AS PERMIT_END_DATE,
  PERMIT.PROPERTIES_AERIAL_COMPLETE AS PERMIT_AERIAL_COMPLETE,
  PERMIT.PROPERTIES_BURRIED_COMPLETE AS PERMIT_BURRIED_COMPLETE,
  -- FPS_SCENARIO.PROPERTIES_ID AS FPS_SCENARIO_ID,
  -- FPS_SCENARIO.PROPERTIES_TITLE AS FPS_SCENARIO_TITLE,
  -- FPS_SCENARIO.PROPERTIES_DESCRIPTION AS FPS_SCENARIO_DESCRIPTION,
  -- FPS_SCENARIO.PROPERTIES_STATUS AS FPS_SCENARIO_TITLE_STATUS,
  -- FPS_SCENARIO.PROPERTIES_USER_GROUP AS FPS_SCENARIO_USER_GROUP,
  -- FPS_SCENARIO.PROPERTIES_SCENARIO_TYPE AS FPS_SCENARIO_SCENARIO_TYPE,
  -- FPS_SCENARIO.PROPERTIES_SESSION_ID AS FPS_SCENARIO_SESSION_ID,
  -- FPS_SCENARIO.PROPERTIES_COMPUTATION_TYPE AS FPS_SCENARIO_COMPUTATION_TYPE,
  -- FPS_SCENARIO.PROPERTIES_COMPUTATION_STATE AS FPS_SCENARIO_COMPUTATION_STATE,
  -- FPS_SCENARIO.PROPERTIES_COMPUTATION_LOG AS FPS_SCENARIO_COMPUTATION_LOG,
  -- FPS_SCENARIO.PROPERTIES_COMPUTATION_LANG AS FPS_SCENARIO_COMPUTATION_LANG,
  -- FPS_SCENARIO.PROPERTIES_APPLICATION_SERVER AS FPS_SCENARIO_APPLICATION_SERVER,
  -- FPS_SCENARIO.PROPERTIES_MASTER_SCENARIO_ID AS FPS_SCENARIO_MASTER_SCENARIO_ID,
  -- FPS_SCENARIO.PROPERTIES_ASSIGNED_VENDOR AS FPS_SCENARIO_ASSIGNED_VENDOR,
  -- FPS_SCENARIO.PROPERTIES_FORCE_DERIVATION_RESET AS FPS_SCENARIO_FORCE_DERIVATION_RESET,
  -- FPS_SCENARIO.PROPERTIES_DERIVATION_RESULTS AS FPS_SCENARIO_DERIVATION,
  -- FPS_SCENARIO.PROPERTIES_CM_PROJECT_TRACKING_NUMBER AS FPS_SCENARIO_CM_PROJECT_TRACKING_NUMBER,
  -- FPS_SCENARIO.PROPERTIES_OPTIMIZATION_RESULTS AS FPS_SCENARIO_OPTIMIZATION,
FROM
  TICKET
LEFT JOIN
  WC_TICKET
ON
  WC_TICKET.PROPERTIES_MYWWFM_TICKET_ID = TICKET.PROPERTIES_ID
LEFT JOIN
  SURVEY
ON
  SURVEY.PROPERTIES_MYWWFM_TICKET_ID = TICKET.PROPERTIES_ID
LEFT JOIN
  DTAP
ON
  DTAP.PROPERTIES_MYWWFM_TICKET_ID = TICKET.PROPERTIES_ID
LEFT JOIN
  FEEDER
ON
  FEEDER.PROPERTIES_MYWWFM_TICKET_ID = TICKET.PROPERTIES_ID
LEFT JOIN
  PERMIT
ON
  PERMIT.PROPERTIES_MYWWFM_TICKET_ID = TICKET.PROPERTIES_ID
-- LEFT JOIN
--   FPS_SCENARIO
-- ON
--   TICKET.PROPERTIES_ID = FPS_SCENARIO.PROPERTIES_CM_PROJECT_TRACKING_NUMBER