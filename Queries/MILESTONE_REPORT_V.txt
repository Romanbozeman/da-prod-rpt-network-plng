WITH
  DELIVERABLE AS(
  SELECT
    *
  FROM
    da-prod-dwh-dw01.DP_BASE_IQGEO_V.MYWCM_DELIVERABLE_V),
  WC_TICKET AS (
  SELECT
    WC_TICKET.*
  FROM
    da-prod-dwh-dw01.DP_BASE_IQGEO_V.MYWCM_WIRE_CENTER_PROJECT_V WC_TICKET),
  TICKET AS (
  SELECT
    *,
    SPLIT(PROPERTIES_MYWWFM_PROJECT_NAME, '-')[
  OFFSET
    (0)] AS TICKET_NAME,
  FROM
    `da-prod-dwh-dw01.DP_BASE_IQGEO_V.MYWWFM_TICKET_V`),
  BRSPD_PREMS AS (
  SELECT
    WC_CLLI,
    SUM(INITIAL_DESIGN_ADDR_CT) AS ADDR_CT,
    SUM(INITIAL_DESIGN_PREM_CT) AS PREM_CT
  FROM
    da-prod-rpt-network-plng.RPT_NETWORK_PLNG_SNDBX_DS.BRSPD_PREMS_V 
  GROUP BY
    1)
SELECT
  TICKET.PROPERTIES_ID AS TICKET_PROPERTIES_ID,
  TICKET.PROPERTIES_MYWWFM_CREATOR_USERNAME AS TICKET_CREATOR_USERNAME,
  TICKET.PROPERTIES_MYWWFM_ASSIGNED_USERNAME AS TICKET_ASSIGNED_USERNAME,
  TICKET.PROPERTIES_MYWWFM_STATUS AS TICKET_STATUS,
  TICKET.PROPERTIES_MYWWFM_TYPE AS TICKET_TYPE,
  TICKET.PROPERTIES_MYWWFM_TYPE_CATEGORY AS TICKET_TYPE_CATEGORY,
  TICKET.PROPERTIES_MYWWFM_CANCELLED_DATETIME AS TICKET_CANCELLED_DATETIME,
  TICKET.PROPERTIES_MYWWFM_CREATED_DATETIME AS TICKET_CREATED_DATETIME,
  TICKET.PROPERTIES_MYWWFM_ASSIGNED_DATETIME AS TICKET_ASSIGNED_DATETIME,
  TICKET.PROPERTIES_MYWWFM_LAST_MODIFIED_DATETIME AS TICKET_LAST_MODIFIED_DATETIME,
  TICKET.PROPERTIES_MYWWFM_TICKET_GROUP AS TICKET_GROUP,
  TICKET.PROPERTIES_MYWWFM_REGION AS TICKET_REGION,
  TICKET.PROPERTIES_MYWWFM_UPDATE_DATETIME AS TICKET_UPDATE_DATETIME,
  TICKET.PROPERTIES_MYWWFM_START_DATETIME AS TICKET_START_DATETIME,
  TICKET.PROPERTIES_MYWWFM_DUE_DATETIME AS TICKET_DUE_DATETIME,
  TICKET.PROPERTIES_MYWWFM_TICKET_DETAILS AS TICKET_TICKET_DETAILS,
  TICKET.PROPERTIES_MYWWFM_ONSITE_DATETIME AS TICKET_ONSITE_DATETIME,
  TICKET.PROPERTIES_MYWWFM_PROJECT AS TICKET_PROJECT,
  TICKET.PROPERTIES_MYWWFM_PROJECT_NAME AS PARENT_TICKET_PROJECT_NAME,
  WC_TICKET.PROPERTIES_CLLI AS WC_TICKET_CLLI,
  WC_TICKET.PROPERTIES_MYWWFM_TICKET_ID AS WC_TICKET_ID,
  WC_TICKET.PROPERTIES_MYWWFM_TICKET_GROUP AS WC_PROPERTIES_TICKET_GROUP,
  WC_TICKET.PROPERTIES_PROFILE AS WC_PROFILE,
  WC_TICKET.PROPERTIES_COMPANY_CODE AS WC_COMPANY_CODE,
  WC_TICKET.PROPERTIES_INVESTMENT_PROGRAM AS WC_INVESTMENT_YEAR,
  WC_TICKET.PROPERTIES_APPROVAL_YEAR AS WC_APPROVAL_YEAR,
  WC_TICKET.PROPERTIES_SAP_PROJECT_NUMBER AS WC_SAP_PROJECT_NUMBER,
  WC_TICKET.PROPERTIES_SAP_WBS_EXPENSE AS WC_SAP_WBS_EXPENSE,
  WC_TICKET.PROPERTIES_SAP_WBS_CAPITAL AS WC_SAP_WBS_CAPITAL,
  WC_TICKET.PROPERTIES_SAP_STATUS AS WC_SAP_STATUS,
  WC_TICKET.PROPERTIES_SAP_LOG AS WC_SAP_LOG,
  WC_TICKET.PROPERTIES_REQUESTOR_COST_CENTER AS WC_REQUESTOR_COST_CENTER,
  WC_TICKET.PROPERTIES_RESPONDER_COST_CENTER AS WC_RESPONDER_COST_CENTER,
  WC_TICKET.PROPERTIES_START_DATE_PLANNING AS WC_START_DATE_PLANNING,
  WC_TICKET.PROPERTIES_END_DATE_PLANNING AS WC_END_DATE_PLANNING,
  WC_TICKET.PROPERTIES_START_DATE_SURVEY AS WC_START_DATE_SURVEY,
  WC_TICKET.PROPERTIES_END_DATE_SURVEY AS WC_END_DATE_SURVEY,
  WC_TICKET.PROPERTIES_START_DATE_PERMIT AS WC_START_DATE_PERMIT,
  WC_TICKET.PROPERTIES_END_DATE_PERMIT AS WC_END_DATE_PERMIT,
  WC_TICKET.PROPERTIES_START_DATE_CONSTRUCTION AS WC_START_DATE_CONSTRUCTION,
  WC_TICKET.PROPERTIES_END_DATE_CONSTRUCTION AS WC_END_DATE_CONSTRUCTION,
  WC_TICKET.PROPERTIES_CONTRACTOR AS WC_CONTRACTOR,
  WC_TICKET.PROPERTIES_CITY AS WC_CITY,
  WC_TICKET.PROPERTIES_STATE AS WC_STATE,
  WC_TICKET.PROPERTIES_ZIP AS WC_ZIP,
  WC_TICKET.PROPERTIES_STREET AS WC_STREET,
  WC_TICKET.PROPERTIES_LOCATION AS WC_LOCATION,
  WC_TICKET.PROPERTIES_ROUTE_OH AS WC_ROUTE_OH,
  WC_TICKET.PROPERTIES_ROUTE_UG AS WC_ROUTE_UG,
  WC_TICKET.PROPERTIES_DTAPS_UG AS WC_DTAPS_UG,
  WC_TICKET.PROPERTIES_DTAPS_OH AS WC_DTAPS_OH,
  DELIVERABLE.PROPERTIES_ID AS DELIVERABLE_ID,
  DELIVERABLE.PROPERTIES_MYWWFM_TICKET_ID AS DELIVERABLE_TICKET_ID,
  DELIVERABLE.PROPERTIES_MYWWFM_PARENT_TICKET_ID AS DELIVERABLE_PARENT_TICKET_ID,
  DELIVERABLE.PROPERTIES_INTERNAL_NAME AS DELIVERABLE_INTERNAL_NAME,
  DELIVERABLE.PROPERTIES_PROPOSED_START AS DELIVERABLE_PROPOSED_START,
  DELIVERABLE.PROPERTIES_PROPOSED_END AS DELIVERABLE_PROPOSED_END,
  DELIVERABLE.PROPERTIES_ACTUAL_START AS DELIVERABLE_ACTUAL_START,
  DELIVERABLE.PROPERTIES_ACTUAL_END AS DELIVERABLE_ACTUAL_END,
  -- DELIVERABLE.PROPERTIES_INTERNAL_DESCRIPTION AS DELIVERABLE_INTERNAL_DESCRIPTION,
  DELIVERABLE.PROPERTIES_STATUS AS DELIVERABLE_STATUS,
  DELIVERABLE.PROPERTIES_CREATED_AT AS DELIVERABLE_CREATED_AT,
  -- DELIVERABLE.PROPERTIES_MANDATORY AS DELIVERABLE_MANDATORY,
  -- DELIVERABLE.PROPERTIES_FILES_ENABLED AS DELIVERABLE_FILES_ENABLED,
  -- DELIVERABLE.PROPERTIES_PHASE AS DELIVERABLE_PHASE,
  -- DELIVERABLE.PROPERTIES_CREATED_USER AS DELIVERABLE_CREATED_USER,
  -- DELIVERABLE.PROPERTIES_SUBMITTED_BY AS DELIVERABLE_SUBMITTED_BY,
  BRSPD_PREMS.ADDR_CT AS ADDRESS_COUNT,
  BRSPD_PREMS.PREM_CT AS PREM_COUNT
FROM
  DELIVERABLE
LEFT JOIN
  TICKET
ON
  TICKET.PROPERTIES_ID = DELIVERABLE.PROPERTIES_MYWWFM_PARENT_TICKET_ID
LEFT JOIN
  WC_TICKET
ON
  WC_TICKET.PROPERTIES_MYWWFM_TICKET_ID = TICKET.PROPERTIES_ID
LEFT JOIN
  BRSPD_PREMS
ON
  BRSPD_PREMS.WC_CLLI = WC_TICKET.PROPERTIES_CLLI